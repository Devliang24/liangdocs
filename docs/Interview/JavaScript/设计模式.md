## 发布订阅模式

```js
const fs = require('node:fs')
const event = {
  _arr: [],
  on(fn) {
    _arr.push(fn)
  },
  emit() {
    _arr.forEach(item => item())
  }
}

const person = {}
event.on(() => {
  console.log('订阅者1')
  console.log(person)
})
event.on(() => {
  console.log('订阅者2')
  if (Object.keys(person).length === 2)
    console.log(person)
})

fs.readFile('./name.txt', (_, data) => {
  person.name = data
  event.emit()
})

fs.readFile('./age.txt', (_, data) => {
  person.age = data
  event.emit()
})
```

> 发布订阅没有直接关联，可以只订阅，不发布，也可以只发布，不订阅。
> 观察者模式会有关联，被观察者存储着观察者列表，被观察者触发事件时，会通知所有观察者。

## 观察者模式

```js
class Observer {
  constructor(name) {
    this.name = name
  }

  update(newValue) {
    log(`${this.name} 更新了，新值为 ${newValue}`)
  }
}

class Subject {
  constructor() {
    this.state = '开心'
    this.arr = []
  }

  add(observer) {
    this.arr.push(observer)
  }

  setState(newValue) {
    this.state = newValue
    this.notify()
  }

  notify() {
    this.arr.forEach(item => item.update(this.state))
  }
}

const subject = new Subject()
const observer1 = new Observer('张三')
const observer2 = new Observer('李四')
subject.add(observer1)
subject.add(observer2)
subject.setState('不开心')
```
